version: '3.7'
services:
    db:
        container_name: pokedex_mysql
        image: mysql:5.7
        command: mysqld --user=root --character-set-server=utf8 --collation-server=utf8_unicode_ci --default-authentication-plugin=mysql_native_password --explicit_defaults_for_timestamp
        # restart: always
        ports:
            - '33306:3306'
        environment:
            MYSQL_ROOT_PASSWORD: abc123
            MYSQL_DATABASE: pokedex_db
            TZ: America/Sao_Paulo
        volumes:
            - ./backend/app/config/init.sql:/docker-entrypoint-initdb.d/init.sql
        networks:
            - pokedex_database
    app:
        container_name: pokedex_frontend
        build:
            dockerfile: frontend/Dockerfile
            context: .
        # restart: always
        networks:
            - pokedex_frontend_web
        ports:
            - '3000:3000'
        volumes:
            - ./frontend/:/usr/src/web
            - ./frontend/node_modules/:/usr/src/web/node_modules
    backend:
        container_name: pokedex_backend
        build:
            dockerfile: backend/Dockerfile
            context: .
        # restart: always
        networks:
            - pokedex_frontend_web
            - pokedex_database
        ports:
            - '8001:8001'
        volumes:
            - ./backend/:/usr/src/backend
        depends_on:
            - db

networks:
    pokedex_frontend_web:
        #external: true
    pokedex_database:
        #external: true
